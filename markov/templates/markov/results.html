<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <meta name="author" content="">

    <title>Analysis Tool</title>

    {% load staticfiles %}

    <!-- Bootstrap Core CSS -->
    <link rel="stylesheet" type="text/css" href="{% static 'home/css/bootstrap.min.css' %}" />

    <!-- Custom CSS -->
    <link rel="stylesheet" type="text/css" href="{% static 'home/css/grayscale.css' %}" />
    <link rel="stylesheet" type="text/css" href="{% static 'home/css/style.css' %}" />
    <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.8.3/jquery.min.js"></script>

    <!-- Custom Fonts -->
    <link href="{% static 'home/font-awesome/css/font-awesome.min.css' %}" rel="stylesheet" type="text/css">

    <link href="http://fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic" rel="stylesheet" type="text/css">
    <link href="http://fonts.googleapis.com/css?family=Montserrat:400,700" rel="stylesheet" type="text/css">
    <link href='http://fonts.googleapis.com/css?family=Lobster' rel='stylesheet' type='text/css'>
    <link href='http://fonts.googleapis.com/css?family=Raleway:300,400,500,600' rel='stylesheet' type='text/css'>


    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->

    <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js" ></script>
    <script type="text/javascript" src="https://www.google.com/jsapi"></script>

    <script type="text/javascript" src="http://jqueryjs.googlecode.com/files/jquery-1.3.1.min.js" > </script> 

    <script type="text/javascript">



        function printDiv(divName) {
            var printContents = document.getElementById(divName).innerHTML;
            console.log(printContents)
            w=window.open();
            w.document.write("<html><head><title>Print Page</title>");
            w.document.write('</head><body>');
            w.document.write(printContents);
            w.document.write('</body></html>');
            w.print();
            w.close();
        }       

        // function PrintDiv() {    
        //     var divToPrint = document.getElementById('divToPrint');
        //     var popupWin = window.open('', '_blank', 'width=300,height=300');
        //     popupWin.document.open();
        //     popupWin.document.write('<html><body onload="window.print()">' + divToPrint.innerHTML + '</html>');
        //     popupWin.document.close();
        // }

        // function PrintElem(elem){
        //     Popup($(elem).html());
        // }

        // function Popup(data){
        //     var mywindow = window.open('', 'my div');
        //     mywindow.document.write('<html><head><title>Print Page</title>');

        //     /*optional stylesheet*/ 
        //     // mywindow.document.write(" <link rel='stylesheet' type='text/css' href='{% static 'home/css/bootstrap.min.css' %}' />");

        //     // mywindow.document.write("<link rel='stylesheet' type='text/css' href='{% static 'home/css/grayscale.css' %}' />");

        //     // mywindow.document.write("<link href='{% static 'home/font-awesome/css/font-awesome.min.css' %}' rel='stylesheet' type='text/css'>");

        //     mywindow.document.write("<div id="linechart1"></div>")

        //     console.log(data)

        //     mywindow.document.write('</head><body >');
        //     mywindow.document.write(data);
        //     mywindow.document.write('</body></html>');

        //     mywindow.document.close(); // necessary for IE >= 10
        //     mywindow.focus(); // necessary for IE >= 10

        //     mywindow.print();
        //     mywindow.close();

        //     return true;
        // }

        // Load the Visualization API and the piechart package.
        google.load('visualization', '1.0', {'packages':['corechart']});
        google.load('visualization', '1', {'packages': ['corechart', 'bar']});
        google.load('visualization', '1.1',{'packages': ['line']});
        google.load("visualization", "1.0", {'packages':['table']});

        // Set a callback to run when the Google Visualization API is loaded.
        google.setOnLoadCallback(drawChart);
        
        function drawChart() {
            var djangoDataTable = {{ tableArr|safe }};
            var dataTable = google.visualization.arrayToDataTable(djangoDataTable);

            var djangoData1 = {{ deathHBV_Final|safe }}
            var data1 = google.visualization.arrayToDataTable(djangoData1);

            var djangoData2 = {{ hcc_Final|safe }}
            var data2 = google.visualization.arrayToDataTable(djangoData2);

            var djangoData3 = {{ cirrhosis_Final|safe }}
            var data3 = google.visualization.arrayToDataTable(djangoData3);



            var options3 = {
                title: "Mortality Rate HBV",
                titleTextStyle :{
                    fontSize:26,
                    fontName:'Raleway',
                },
                colors: ['#ff7f50','#49B7A8'],
                
                width: 400,
                height: 400,
                vAxis: {
                    title:'Percentage (%)',
                },
                hAxis:{
                    title:'Year',
                },
                legend:{
                    position:'none',
                    maxLines: 2,
                }
            };

            var options4 = {
                title: "Cirrhosis",
                titleTextStyle :{
                    fontSize:26,
                    fontName:'Raleway',
                },
                colors: ['#ff7f50','#49B7A8'],
                width: 400,
                height: 400,
                vAxis: {
                    title:'Percentage (%)',
                },
                hAxis:{
                    title:'Year',
                },
                legend:{
                    position:'none',
                    maxLines: 2,
                }
            };

            var options5 = {
                title: "Liver Cancer",
                titleTextStyle :{
                    fontSize:26,
                    fontName:'Raleway',
                },
                colors: ['#ff7f50','#49B7A8'],
                
                width: 400,
                height: 400,
                vAxis: {
                    title:'Percentage (%)',
                },
                hAxis:{
                    title:'Year',
                },
                legend:{
                    position:'none',
                    maxLines: 2,
                }
            };

            var optionsTable = {
                'showRowNumber': false,
                'width': '100%',
                'height': '100%',
                'allowHtml': true, 
            };

            var chart3 = new google.visualization.LineChart(document.getElementById('linechart1'));
            chart3.draw(data1, options3);

            if({{ ifCirr }} == 0){
                var chart4 = new google.visualization.LineChart(document.getElementById('linechart2'));
                chart4.draw(data3, options4);
            }

            var chart5 = new google.visualization.LineChart(document.getElementById('linechart3'));
            chart5.draw(data2, options5);

            for (y = 0; y < 4; y++){
                dataTable.setCell(y,0,String(djangoDataTable[y+1][0]),null,{'style': ' font-size:20px;'})
            }

            for (j = 1; j < djangoDataTable[1].length; j += 2){
                for (i = 0; i < 4; i++) { 
                    dataTable.setCell(i,j,String(djangoDataTable[i+1][j]),null,{'style': 'background-color: rgba(255,127,80,0.7); font-size:18px;'})
                }
            }

            for (j = 2; j < djangoDataTable[1].length; j += 2){
                for (i = 0; i < 4; i++) { 
                    dataTable.setCell(i,j,String(djangoDataTable[i+1][j]),null,{'style': 'background-color: #49b7a8; font-size:18px;'})
                }
            }

            var table = new google.visualization.Table(document.getElementById('table_div'));
            table.draw(dataTable, optionsTable);
        }
    </script>
</head>


<body id="page-top" data-spy="scroll" data-target=".navbar-fixed-top">

    <!-- Navigation -->
    <nav class="navbar navbar-custom navbar-fixed-top" role="navigation">
        <div class="container">
            <div class="navbar-header">
                <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-main-collapse">
                    <i class="fa fa-bars"></i>
                </button>
                <a class="navbar-brand page-scroll" href="../../">
                    <i class="fa fa-play-circle"></i>  <span class="light">Home</span>
                </a>
            </div>

            <!-- Collect the nav links, forms, and other content for toggling -->
            <div class="collapse navbar-collapse navbar-right navbar-main-collapse">
                <ul class="nav navbar-nav">
                    <!-- Hidden li included to remove active class from about link when scrolled up past about section -->
                    <li class="hidden">
                        <a href="#page-top"></a>
                    </li>
                    <li>
                        <a class="page-scroll" href="#Result">Results</a>
                    </li>
                    <li>
                        <a class="page-scroll" href="#Contact">Contact</a>
                    </li>

                </ul>
            </div>
            <!-- /.navbar-collapse -->
        </div>
        <!-- /.container -->
    </nav>

    <!-- Intro Header -->
    <header class="intro">
        <div class="intro-body">
            <div class="container">
                <div class="row">
                    <div class="col-md-8 col-md-offset-2">
                        <h1 class="brand-heading" style="color: #fff; text-transform: none; font-size:130px;">Results</h1>
                        <p class="intro-text" style="color: #000; font-family:'Lora'; letter-spacing: 2px; font-weight:bold; ">Treated and Untreated Survival Rates of Patients</p>
                        <a href="#Result" class="page-scroll">
                            <i class="fa fa-angle-double-down animated" id="arrow"></i>
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Results Section -->
    <section id="Result" class="container content-section text-center">
        <br><br><br>
        <div class="col-lg-8 col-lg-offset-2">
            <h2 style="margin-top: 75px;">Your Responses</h2>
            <div id="user-input">
                <p>{{inputStr}}</p>
            </div>
            <div id="chart_div" style= "width:750; height:750"></div>
        </div>
        <div id='divToPrint'>
            <div class="row">
                <div>
                    <div class="graph-row">
                        <div id="linechart1"></div>
                        <div id="linechart3"></div>
                    </div>
                    <div class="graph-row">
                        <div id="linechart2"></div>
                        <div id="linechart4"></div>
                    </div>
                    <div>
                        <h2 style="padding-top:75px;"> <span style="color:#ff7f50">Natural History</span> | <span style="color:#49B7A8">Treatment</span> </h2>
                    </div>
                    <div style= "width: 800px; height: 350px;"id="table_div"></div>
                </div>
            </div>
            <br>
            <h2 style="margin-top: 75px;">World Health Organization's Recommendation</h2>
            <div id="user-input" style="padding-bottom: 50px;">
                <p>{{whoRec}}</p>
            </div>
            <div style="width: 80%; display: table; margin: 0 auto; border-collapse: separate;">
                <div style="display: table-row;">
                    <div id='who-row' style="width: 50%; display: table-cell; border-left: 3px #000 solid; border-top: solid 3px #000; border-bottom: solid 3px #000; padding-left:30px;">
                        <p>
                            <h4 align="left">Every 6 Months</h4><p align='left'> DETECTION OF HCC (person with cirrhosis or HCC family history).</p>
                            <h4 align='left'>Every 12 Months</h4><p align='left'> DISEASE PROGRESSION AND/OR TREATMENT RESPONSE IN ALL<br> Adherence at each visit, if on treatment<br> ALT, HBV DNA and HBeAg<br> Clinical criteria and NITs (APRI in adults or FibroScan)</p>
                            <h4 align='left'>Baseline and Every 12 months</h4><p align='left'> TOXICITY MONITORING IN PERSONS ON TREATMENT: Renal function and risk factors for renal dysfunction</p>
                              
                        </p>
                    </div>
                    <div id = 'who-row' style="display: table-cell; border-right: 3px #000 solid; border-top: solid 3px #000; border-bottom: solid 3px #000; padding-right:30px;">
                        <div>
                        <p align="left">All persons with CHB should be monitored regularly for disease activity/progression and detection of HCC, and after stopping treatment for evidence of reactivation. </p>
                        <p align="left">More frequent monitoring maybe required in those with more advanced liver disease, during the first year of treatment or where adherence is a concern, and in those with abnormal ALT and HBV DNA levels >2000 IU/mL, not yet on treatment.</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <section id="Contact" class="container content-section text-center">
        <div>
            <input type="button" class="btn btn-square" value="Print" onclick="printDiv('divToPrint')" />
        </div>
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2">
                <h2>Contact The Asian Liver Center</h2>
                <p>Feel free to <a href="mailto:research.cs.alc@gmail.com" target="_blank">email</a> us to provide some feedback!</p>
                <div style="padding-bottom: 20px;">
                    <form action="MAILTO:research.cs.alc@gmail.com" method="post" enctype="text/plain">
                        Name:
                    <input type="text" name="name" value=""><br><br>
                        E-mail:
                    <input type="text" name="mail" value=""><br><br>
                        Comment:<br>
                    <textarea rows="5" cols="50" name="comment" id="comment"></textarea>
                    <br><br>
                    <input class="btn btn-default btn-lg" type="submit" value="Send">
                    </form>                    
                </div>
                <ul class="list-inline banner-social-buttons">
                    <li>
                        <a href="https://twitter.com/asianliverctr" class="btn btn-default btn-lg"><i class="fa fa-twitter fa-fw"></i> <span class="network-name">Twitter</span></a>
                    </li>
                    <li>
                        <a href="https://github.com/colphin/Analysis_Tool" class="btn btn-default btn-lg"><i class="fa fa-github fa-fw"></i> <span class="network-name">Github</span></a>
                    </li>
                </ul>
                <ul class="list-inline banner-social-buttons" style="padding-top: 75px;">

                    <li>
                        <a href="http://liver.stanford.edu/jrc/index.html" class="link">
                        <span class="glyphicon glyphicon glyphicon-globe" aria-hidden="true" style="display:block; font-size: 50px; padding-bottom: 10px; color:black;"></span>
                            Join the campaign
                        </a>
                    </li>
                </ul>

                <h3 style="padding-top: 120px;">Want to help out or get to know us better?</h3>
                <p>Read about or reach out to the team <a href="/#team">here</a>.</p>
            </div>
        </div>
    </section>

    <footer>
        <div class="container text-center">
            <p>Copyright &copy; <a href="http://liver.stanford.edu/" target="_blank">Asian Liver Center 2015</a></p>
        </div>
    </footer>

    <!-- jQuery -->
    <script src="{% static 'home/js/jquery.js' %}"></script>

    <!-- Bootstrap Core JavaScript -->
    <script src="{% static 'home/js/bootstrap.min.js' %}"></script>

    <!-- Plugin JavaScript -->
    <script src="{% static 'home/js/jquery.easing.min.js' %}"></script>

    <!-- Google Maps API Key - Use your own API key to enable the map feature. More information on the Google Maps API can be found at https://developers.google.com/maps/ -->
    <script type="text/javascript" src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCWgoJVJgzqUcbnYRL1CIfZglQN8rlMUs8&sensor=false"></script>

    <!-- Custom Theme JavaScript -->
    <script src="{% static 'home/js/grayscale.js' %}"></script>

</body>

</html>